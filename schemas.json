{
  "tools": [
    {
      "name": "fabric.agent.list",
      "description": "List all registered agents with their capabilities, status, and metadata. Supports filtering by capability, tag, or status.",
      "inputSchema": {
        "type": "object",
        "properties": {
          "filter": {
            "type": "object",
            "description": "Optional filters to narrow down agent list",
            "properties": {
              "capability": {
                "type": "string",
                "description": "Filter by capability name (e.g., 'reason', 'code', 'vision')"
              },
              "tag": {
                "type": "string",
                "description": "Filter by agent tag (e.g., 'dev', 'production', 'planner')"
              },
              "status": {
                "type": "string",
                "enum": ["online", "offline", "degraded", "unknown"],
                "description": "Filter by agent health status"
              }
            }
          }
        }
      }
    },
    {
      "name": "fabric.agent.describe",
      "description": "Get detailed information about a specific agent, including full capability manifests with input/output schemas, streaming support, and timeout limits.",
      "inputSchema": {
        "type": "object",
        "properties": {
          "agent_id": {
            "type": "string",
            "description": "The unique identifier of the agent to describe"
          }
        },
        "required": ["agent_id"]
      }
    },
    {
      "name": "fabric.call",
      "description": "Call an agent's capability with a task. This is the primary agent-to-agent communication tool. Supports both synchronous and streaming responses.",
      "inputSchema": {
        "type": "object",
        "properties": {
          "agent_id": {
            "type": "string",
            "description": "The unique identifier of the target agent"
          },
          "capability": {
            "type": "string",
            "description": "The capability to invoke (e.g., 'reason', 'code', 'vision')"
          },
          "task": {
            "type": "string",
            "description": "The task description or prompt for the agent"
          },
          "context": {
            "type": "object",
            "description": "Optional context object with additional parameters, constraints, or data",
            "properties": {},
            "additionalProperties": true
          },
          "stream": {
            "type": "boolean",
            "description": "Whether to stream the response (tokens, progress, events) or wait for final result",
            "default": false
          },
          "timeout_ms": {
            "type": "integer",
            "description": "Maximum execution time in milliseconds",
            "default": 60000,
            "minimum": 1000,
            "maximum": 300000
          },
          "trace": {
            "type": "object",
            "description": "Optional trace context for distributed tracing",
            "properties": {
              "trace_id": {
                "type": "string",
                "description": "Existing trace ID to continue (UUID format)"
              },
              "parent_span_id": {
                "type": "string",
                "description": "Parent span ID for this call (UUID format)"
              }
            }
          }
        },
        "required": ["agent_id", "capability", "task"]
      }
    },
    {
      "name": "fabric.route.preview",
      "description": "Preview where a call would be routed without executing it. Useful for debugging, testing routing logic, and understanding fallback behavior.",
      "inputSchema": {
        "type": "object",
        "properties": {
          "agent_id": {
            "type": "string",
            "description": "The target agent ID"
          },
          "capability": {
            "type": "string",
            "description": "The capability to check"
          }
        },
        "required": ["agent_id", "capability"]
      }
    },
    {
      "name": "fabric.health",
      "description": "Check the health status of the Fabric gateway, registry, and connected agent runtimes. Returns overall system health and component-level status.",
      "inputSchema": {
        "type": "object",
        "properties": {}
      }
    }
  ],
  "responses": {
    "fabric.agent.list": {
      "type": "object",
      "properties": {
        "agents": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "agent_id": {
                "type": "string",
                "description": "Unique agent identifier"
              },
              "display_name": {
                "type": "string",
                "description": "Human-readable agent name"
              },
              "version": {
                "type": "string",
                "description": "Semantic version (e.g., '1.2.0')"
              },
              "status": {
                "type": "string",
                "enum": ["online", "offline", "degraded", "unknown"],
                "description": "Current health status"
              },
              "endpoint": {
                "type": "object",
                "properties": {
                  "transport": {
                    "type": "string",
                    "enum": ["http", "ws", "local", "stdio"],
                    "description": "Transport protocol"
                  },
                  "uri": {
                    "type": "string",
                    "description": "Endpoint URI or connection string"
                  }
                },
                "required": ["transport", "uri"]
              },
              "capabilities": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string",
                      "description": "Capability identifier"
                    },
                    "modalities": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "enum": ["text", "image", "audio", "video", "code"]
                      },
                      "description": "Supported input/output modalities"
                    },
                    "streaming": {
                      "type": "boolean",
                      "description": "Whether this capability supports streaming"
                    }
                  },
                  "required": ["name", "modalities", "streaming"]
                }
              },
              "tags": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Searchable tags for categorization"
              },
              "trust_tier": {
                "type": "string",
                "enum": ["local", "org", "public"],
                "description": "Trust level for security policy"
              }
            },
            "required": ["agent_id", "display_name", "version", "status", "endpoint", "capabilities"]
          }
        }
      },
      "required": ["agents"]
    },
    "fabric.agent.describe": {
      "type": "object",
      "properties": {
        "agent": {
          "type": "object",
          "properties": {
            "agent_id": {
              "type": "string"
            },
            "display_name": {
              "type": "string"
            },
            "version": {
              "type": "string"
            },
            "description": {
              "type": "string",
              "description": "Detailed agent description"
            },
            "capabilities": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  },
                  "input_schema": {
                    "type": "object",
                    "description": "JSON Schema for capability input"
                  },
                  "output_schema": {
                    "type": "object",
                    "description": "JSON Schema for capability output"
                  },
                  "streaming": {
                    "type": "boolean"
                  },
                  "max_timeout_ms": {
                    "type": "integer"
                  },
                  "modalities": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": ["name", "description", "input_schema", "output_schema", "streaming"]
              }
            },
            "endpoint": {
              "type": "object"
            },
            "tags": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "trust_tier": {
              "type": "string"
            }
          },
          "required": ["agent_id", "capabilities"]
        }
      },
      "required": ["agent"]
    },
    "fabric.call.sync": {
      "type": "object",
      "description": "Synchronous response when stream=false",
      "properties": {
        "ok": {
          "type": "boolean",
          "description": "Whether the call succeeded"
        },
        "trace": {
          "type": "object",
          "properties": {
            "trace_id": {
              "type": "string",
              "description": "Distributed trace ID (UUID)"
            },
            "span_id": {
              "type": "string",
              "description": "Span ID for this call (UUID)"
            }
          },
          "required": ["trace_id", "span_id"]
        },
        "result": {
          "type": "object",
          "description": "Agent-specific result payload",
          "properties": {
            "answer": {
              "type": "string"
            },
            "data": {
              "type": "object"
            },
            "artifacts": {
              "type": "array"
            },
            "citations": {
              "type": "array"
            }
          },
          "additionalProperties": true
        }
      },
      "required": ["ok", "trace", "result"]
    },
    "fabric.call.stream": {
      "description": "Streaming response when stream=true. Returns SSE or WebSocket events.",
      "events": [
        {
          "event": "status",
          "data": {
            "type": "object",
            "properties": {
              "status": {
                "type": "string",
                "enum": ["queued", "running", "complete", "error"]
              },
              "message": {
                "type": "string"
              },
              "trace": {
                "type": "object"
              }
            }
          }
        },
        {
          "event": "token",
          "data": {
            "type": "object",
            "properties": {
              "text": {
                "type": "string",
                "description": "Incremental text token"
              },
              "trace": {
                "type": "object"
              }
            }
          }
        },
        {
          "event": "tool_call",
          "data": {
            "type": "object",
            "properties": {
              "tool": {
                "type": "string"
              },
              "arguments": {
                "type": "object"
              },
              "trace": {
                "type": "object"
              }
            }
          }
        },
        {
          "event": "progress",
          "data": {
            "type": "object",
            "properties": {
              "percent": {
                "type": "number",
                "minimum": 0,
                "maximum": 100
              },
              "message": {
                "type": "string"
              },
              "trace": {
                "type": "object"
              }
            }
          }
        },
        {
          "event": "final",
          "data": {
            "type": "object",
            "properties": {
              "ok": {
                "type": "boolean"
              },
              "result": {
                "type": "object"
              },
              "trace": {
                "type": "object"
              }
            }
          }
        }
      ]
    },
    "fabric.route.preview": {
      "type": "object",
      "properties": {
        "selected_runtime": {
          "type": "object",
          "properties": {
            "transport": {
              "type": "string"
            },
            "uri": {
              "type": "string"
            },
            "adapter": {
              "type": "string",
              "description": "Runtime adapter type (e.g., 'RuntimeMCP', 'RuntimeAgentZero')"
            }
          },
          "required": ["transport", "uri", "adapter"]
        },
        "policy": {
          "type": "object",
          "properties": {
            "allowed": {
              "type": "boolean"
            },
            "reason": {
              "type": "string"
            }
          },
          "required": ["allowed", "reason"]
        },
        "fallbacks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "agent_id": {
                "type": "string"
              },
              "reason": {
                "type": "string"
              },
              "priority": {
                "type": "integer"
              }
            }
          }
        }
      },
      "required": ["selected_runtime", "policy", "fallbacks"]
    },
    "fabric.health": {
      "type": "object",
      "properties": {
        "ok": {
          "type": "boolean",
          "description": "Overall system health"
        },
        "registry": {
          "type": "string",
          "enum": ["ok", "degraded", "down"],
          "description": "Registry health status"
        },
        "runtimes": {
          "type": "object",
          "properties": {
            "online": {
              "type": "integer",
              "description": "Number of online agents"
            },
            "offline": {
              "type": "integer",
              "description": "Number of offline agents"
            },
            "degraded": {
              "type": "integer",
              "description": "Number of degraded agents"
            }
          },
          "required": ["online", "offline", "degraded"]
        },
        "version": {
          "type": "string",
          "description": "Fabric server version"
        },
        "uptime_seconds": {
          "type": "integer",
          "description": "Server uptime in seconds"
        }
      },
      "required": ["ok", "registry", "runtimes", "version"]
    },
    "error": {
      "type": "object",
      "description": "Standard error response for all tools",
      "properties": {
        "ok": {
          "type": "boolean",
          "const": false
        },
        "error": {
          "type": "object",
          "properties": {
            "code": {
              "type": "string",
              "enum": [
                "AGENT_OFFLINE",
                "AGENT_NOT_FOUND",
                "CAPABILITY_NOT_FOUND",
                "AUTH_DENIED",
                "AUTH_EXPIRED",
                "AUTH_INVALID",
                "TIMEOUT",
                "BAD_INPUT",
                "UPSTREAM_ERROR",
                "INTERNAL_ERROR",
                "RATE_LIMITED"
              ],
              "description": "Machine-readable error code"
            },
            "message": {
              "type": "string",
              "description": "Human-readable error message"
            },
            "details": {
              "type": "object",
              "description": "Additional context about the error",
              "additionalProperties": true
            }
          },
          "required": ["code", "message"]
        },
        "trace": {
          "type": "object",
          "properties": {
            "trace_id": {
              "type": "string"
            },
            "span_id": {
              "type": "string"
            }
          },
          "required": ["trace_id", "span_id"]
        }
      },
      "required": ["ok", "error", "trace"]
    }
  },
  "canonical_envelope": {
    "description": "Internal envelope format used for routing between Fabric and agent runtimes",
    "type": "object",
    "properties": {
      "trace": {
        "type": "object",
        "properties": {
          "trace_id": {
            "type": "string",
            "description": "UUID for distributed tracing"
          },
          "span_id": {
            "type": "string",
            "description": "UUID for this span"
          },
          "parent_span_id": {
            "type": ["string", "null"],
            "description": "Parent span UUID or null"
          }
        },
        "required": ["trace_id", "span_id", "parent_span_id"]
      },
      "auth": {
        "type": "object",
        "properties": {
          "mode": {
            "type": "string",
            "enum": ["psk", "passport", "mtls", "none"]
          },
          "principal_id": {
            "type": ["string", "null"],
            "description": "Authenticated principal (user or agent)"
          },
          "agent_passport_id": {
            "type": ["string", "null"],
            "description": "Agent passport identifier"
          },
          "signature": {
            "type": ["string", "null"],
            "description": "Cryptographic signature (base64)"
          },
          "key_id": {
            "type": ["string", "null"],
            "description": "Key identifier for signature verification"
          }
        },
        "required": ["mode"]
      },
      "target": {
        "type": "object",
        "properties": {
          "agent_id": {
            "type": "string"
          },
          "capability": {
            "type": "string"
          },
          "timeout_ms": {
            "type": "integer",
            "default": 60000
          }
        },
        "required": ["agent_id", "capability"]
      },
      "input": {
        "type": "object",
        "properties": {
          "task": {
            "type": "string"
          },
          "context": {
            "type": "object",
            "additionalProperties": true
          },
          "attachments": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["file", "url", "data"]
                },
                "content": {
                  "type": "string"
                },
                "mime_type": {
                  "type": "string"
                }
              }
            }
          }
        },
        "required": ["task"]
      },
      "response": {
        "type": "object",
        "properties": {
          "stream": {
            "type": "boolean",
            "default": false
          },
          "format": {
            "type": "string",
            "enum": ["text", "json", "toolcalls"],
            "default": "text"
          }
        }
      }
    },
    "required": ["trace", "auth", "target", "input", "response"]
  }
}
